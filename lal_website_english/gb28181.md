# lalserver access national standard GB28181

## ▦ Features

The open-source [Go Streaming Media Project lal](https://github.com/q191201771/lal) supports the Chinese National Standard protocol [GB28181](https://programming.vip/docs/gb28181-protocol-real-time-video-and-audio-on-demand-preview.html).  
Current support of GB28181 PS(RTP) media streams pushed to lalserver is via trans-encapsulation, so as to support a variety of recording protocols (such as HLS), pull stream playback (such as HTTP-FLV) and other functions.

## ▦ How to use it

1) Start lalserver  

> See: [▦ II. lalserver installation, running - lal official documentation"](https://pengrl.com/lal/#/?id=%e2%96%a6-%e4%ba%8c-lalserver-%e5%ae%89%e8%a3%85%e3%80%81%e8%bf%90%e8%a1%8c)

2) Notify lalserver that it is ready to receive GB28181 audio/video streams  

Send a command to lalserver via the HTTP-API interface `start_rtp_pub` to make lalserver start the RTP receiving stream port.  
The `start_rtp_pub` interface also supports some handy configuration items, such as specifying the stream name, timeout, and using TCP or UDP.  

> For details, see: https://pengrl.com/lal/#/HTTPAPI?id=_24-apictrlstart_rtp_pub

3) Push ps(rtp) stream to lalserver  

4) Check if the stream is OK after entering lalserver. For example, check the recording file of lalserver, use HTTP-FLV, HLS and other protocols to pull stream to play, etc.  

Note that the lalserver does not contain a (SIP) signalling component, i.e. the lalserver is not responsible for managing when the (camera) push streaming side pushes to the lalserver. The third step above needs to be triggered by the business side itself.

> Here is some additional knowledge on GB28181.
>
> Camera GB28181 pushstream:
> 
> There are generally three roles: camera, SIP server, and streaming server.
> 
> > Basic flow:
> 
> 1) Camera registers itself to SIP server. Method: open the camera configuration page, fill in the IP and port of the SIP server under `local SIP port`.
> 2) Open the `Streaming Receive Port` of the streaming server to get the streaming server ready to receive data. Method: call lalserver HTTP-API with `start_rtp_pub` 
> 3) The SIP server asks the camera to push data to the streaming server. Details: the streaming server address is transferred to the camera in SDP format.
> 
> Camera and SIP server: SIP protocol
> SIP service and streaming server: (provided by lalserver) HTTP-API
> Camera and streaming server: RTP PS streaming
> 
> 
> Here some students may have questions, why step 2 is needed, why not let the streaming server receive the camera's push stream data at a fixed address? This is because.
> 
> 1) The streaming server needs to support receiving streams from multiple cameras.
> If it receives streams from multiple cameras at the same address, then it can only be distinguished by SSRC or camera address, neither of which works 100% of the time, e.g. the SSRC of multiple cameras may be the same, e.g. the SSRC and address of one camera may change.
> Also take into account that, most of the time, the SSRC used by the camera is determined by the camera itself.
> 
> 2) Establish a logical mapping between camera streams and streams in the streaming system by calling the streaming server's interface for ease of use.
> To put it plainly, for example, if you name a camera `camera1` when you call the interface, then you can use the stream name `camera1` to play it when you play it later using protocols such as HTTP-FLV, HLS, etc.> If you name it, then you can use it to play it back.
> If you don't name it, then it's back to the problem mentioned above, do you use SSRC? SSRC may become heavy, and it's more troublesome to manage.

## ▦ Feedback on the problem

There is a debug parameter `debug_dump_packet` in the `start_rtp_pub` interface, through which incoming UDP data is saved to a file (preferably with lalserver in debugging mode), and sent to the lal author to help analyse the problem.

> See specifically: https://github.com/q191201771/lalext/blob/master/lal_website/HTTPAPI.md#24-apictrlstart_rtp_pub

Issue feedback channels:  
1) Posting an issue on lal's GitHub: https://github.com/q191201771/lal/issues  
2) lal author's handle: q191201771  

For more lal documentation, see: ["lal official documentation home page"](https://pengrl.com/lal)

▦ this note created at 202208, updated at 202209, yoko
